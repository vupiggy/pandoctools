\documentclass[11pt,titlepage,twoside]{article}

\usepackage{xeCJK}
\usepackage{xltxtra} % this package loads fontspec
\defaultfontfeatures{Mapping=tex-text}

\setmainfont{Palatino}

% pandoc doesn't substitude variable recursively,
% we have to do it in the root template file.
% monspace: especially for code listing
%
% Cascadia looks good, but can not be copied correctly from the generated PDF
\setmonofont[
% For pandoc
$if(fontpath)$
  Path           = $fontpath$,
$endif$
  % Extension      = .ttf,
  UprightFont    = *-Regular,
  BoldFont       = *-Bold,
  ItalicFont     = *-Italic,
  BoldItalicFont = *-BoldItalic,
  %Scale          = 1.1
]{UbuntuMono} %{fantasquesansmono}

\setCJKmainfont[
% For pandoc
$if(fontpath)$
  Path           = $fontpath$,
$endif$
  BoldFont={Hiragino Sans GB W6.ttc}, % {SourceHanSansHWSC-Bold.otf} ,
  ItalicFont={AdobeKaitiStd-Regular.otf},
  ItalicFeatures={Scale=1.08},
]{Hiragino Sans GB W3.ttc} % {SourceHanSansHWSC-Regular.otf} %{SourceHanSerifSC-Regular.otf}
\setCJKmonofont[
$if(fontpath)$
  Path           = $fontpath$,
$endif$
  ItalicFont     = AdobeKaitiStd-Regular.otf,
]{AdobeKaitiStd-Regular.otf}
\def\fontset{true}

$if(zh)$
\def\zh{true}
$endif$

\input{preamble}
$if(highlighting-macros)$
$highlighting-macros$
$endif$
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\begin{document}

\newcounter{groupdef}

\pagestyle{empty}
%%% pt Depends on the used fonts 
\setlength\cftbeforesecskip{6pt}
\setlength\cftbeforesubsecskip{6pt}
\setlength\cftbeforesubsubsecskip{20pt}
\tableofcontents
\newpage

$if(watermark)$
\newwatermark*[oddpages,color=red!5,angle=60,scale=12,xpos=-46,ypos=36]{\usebox\mybox}
\newwatermark*[evenpages,color=red!5,angle=60,scale=12,xpos=-59,ypos=36]{\usebox\mybox}
$endif$
\setlength{\headheight}{15pt} % fancyhead should be at least 14.03358pt
\pagestyle{fancy}

$body$

\end{document}
